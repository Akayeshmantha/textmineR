<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ol start="2" style="list-style-type: decimal">
<li>document clustering</li>
</ol> • textmineR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="&lt;ol start=" style="list-style-type: decimal">
</head>
<body>
<li>document clustering</li>
" /&gt;

<meta property="og:description" content="">
<meta property="og:image" content="https://www.rtextmineR.com/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">textmineR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.3.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_start_here.html">1. Start here</a>
    </li>
    <li>
      <a href="../articles/b_document_clustering.html">2. document clustering</a>
    </li>
    <li>
      <a href="../articles/c_topic_modeling.html">3. Topic modeling</a>
    </li>
    <li>
      <a href="../articles/d_text_embeddings.html">4. Text embeddings</a>
    </li>
    <li>
      <a href="../articles/e_doc_summarization.html">5. Document summarization</a>
    </li>
    <li>
      <a href="../articles/f_tidytext_example.html">6. Using tidytext with textmineR</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1><ol start="2" style="list-style-type: decimal">
<li>document clustering</li>
</ol></h1>
                        <h4 class="author">Thomas W. Jones</h4>
            
            <h4 class="date">2019-03-25</h4>
      
      
      <div class="hidden name"><code>b_document_clustering.Rmd</code></div>

    </div>

    
    
<div id="document-clustering" class="section level1">
<h1 class="hasAnchor">
<a href="#document-clustering" class="anchor"></a>Document clustering</h1>
<p>A common task in text mining is document clustering. There are other ways to cluster documents. However, for this vignette, we will stick with the basics. The example below shows the most common method, using <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">TF-IDF</a> and cosine distance.</p>
<p>Let’s read in some data and make a document term matrix (DTM) and get started.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(textmineR)
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'textmineR'</span>
<span class="co">#&gt; The following object is masked from 'package:Matrix':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     update</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     update</span>

<span class="co"># load nih_sample data set from textmineR</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(nih_sample)

<span class="co"># create a document term matrix </span>
dtm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreateDtm.html">CreateDtm</a></span>(<span class="dt">doc_vec =</span> nih_sample<span class="op">$</span>ABSTRACT_TEXT, <span class="co"># character vector of documents</span>
                 <span class="dt">doc_names =</span> nih_sample<span class="op">$</span>APPLICATION_ID, <span class="co"># document names</span>
                 <span class="dt">ngram_window =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># minimum and maximum n-gram length</span>
                 <span class="dt">stopword_vec =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(stopwords<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stopwords/topics/stopwords">stopwords</a></span>(<span class="st">"en"</span>), <span class="co"># stopwords from tm</span>
                                  stopwords<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stopwords/topics/stopwords">stopwords</a></span>(<span class="dt">source =</span> <span class="st">"smart"</span>)), <span class="co"># this is the default value</span>
                 <span class="dt">lower =</span> <span class="ot">TRUE</span>, <span class="co"># lowercase - this is the default value</span>
                 <span class="dt">remove_punctuation =</span> <span class="ot">TRUE</span>, <span class="co"># punctuation - this is the default</span>
                 <span class="dt">remove_numbers =</span> <span class="ot">TRUE</span>, <span class="co"># numbers - this is the default</span>
                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Turn off status bar for this demo</span>
                 <span class="dt">cpus =</span> <span class="dv">2</span>) <span class="co"># default is all available cpus on the system</span>

<span class="co"># construct the matrix of term counts to get the IDF vector</span>
tf_mat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TermDocFreq.html">TermDocFreq</a></span>(dtm)</code></pre></div>
<p>First, we must re-weight the word counts in the document term matrix. We do this by multiplying the term frequency (in this case, count of words in documents) by an inverse document frequency (IDF) vector. textmineR calculates IDF for the <span class="math inline">\(i\)</span>-th word as</p>
<span class="math display">\[\begin{align}
  IDF_i = ln\big(\frac{N}{\sum_{j = 1}^N C(word_i, doc_j)}\big)
\end{align}\]</span>
<p>where <span class="math inline">\(N\)</span> is the number of documents in the corpus.</p>
<p>By default, when you multiply a matrix with a vector, R multiplies the vector to each column. For this reason, we need to transpose the DTM before multiplying the IDF vector. Then we transpose it back to the original orientation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># TF-IDF and cosine similarity</span>
tfidf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(dtm[ , tf_mat<span class="op">$</span>term ]) <span class="op">*</span><span class="st"> </span>tf_mat<span class="op">$</span>idf

tfidf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(tfidf)</code></pre></div>
<p>The next step is to calculate cosine similarity and change it to a distance. We’re going to use some linear algebra to do this. The dot product of two positive-valued, unit-length vectors is the cosine similarity between the two vectors. For a deeper explanation of the math and logic, read <a href="https://anythingbutrbitrary.blogspot.com/2013/03/build-search-engine-in-20-minutes-or.html">this article</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
csim &lt;-<span class="st"> </span>tfidf <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(tfidf <span class="op">*</span><span class="st"> </span>tfidf))

csim &lt;-<span class="st"> </span>csim <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(csim)</code></pre></div>
<p>R’s various clustering functions work with distances, not similarities. We convert cosine similarity to cosine distance by subtracting it from <span class="math inline">\(1\)</span>. This works because cosine similarity is bound between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. While we are at it, we’ll convert the matrix to a <code>dist</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
cdist &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/dist">as.dist</a></span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>csim)</code></pre></div>
<p>The last step is clustering. There are many clustering algorithms out there. My preference is <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">agglomerative hierarchical clustering</a> using <a href="https://en.wikipedia.org/wiki/Ward%27s_method">Ward’s method</a> as the merge rule. Compared to other methods, such as k-means, hierarchical clustering is computationally inexpensive.</p>
<p>In the example below, I choose to cut the tree at <span class="math inline">\(10\)</span> clusters. This is a somewhat arbitrary choice. I often prefer to use the silhouette coefficient. You can read about this method <a href="http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determining-the-optimal-number-of-clusters-3-must-know-methods/">here</a>. Performing this is an exercise I’ll leave to the reader.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
hc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/hclust">hclust</a></span>(cdist, <span class="st">"ward.D"</span>)

clustering &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cutree">cutree</a></span>(hc, <span class="dv">10</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(hc, <span class="dt">main =</span> <span class="st">"Hierarchical clustering of 100 NIH grant abstracts"</span>,
     <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">yaxt =</span> <span class="st">"n"</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/rect.hclust">rect.hclust</a></span>(hc, <span class="dv">10</span>, <span class="dt">border =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="b_document_clustering_files/figure-html/unnamed-chunk-5-1.png" width="720"></p>
<p>It might be nice to get an idea of what’s in each of these clusters. We can use the probability difference method from above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_words &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(dtm) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(dtm)

cluster_words &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(clustering), <span class="cf">function</span>(x){
  rows &lt;-<span class="st"> </span>dtm[ clustering <span class="op">==</span><span class="st"> </span>x , ]
  
  <span class="co"># for memory's sake, drop all words that don't appear in the cluster</span>
  rows &lt;-<span class="st"> </span>rows[ , <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(rows) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ]
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(rows) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(rows) <span class="op">-</span><span class="st"> </span>p_words[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(rows) ]
})</code></pre></div>
<p>The code chunk below creates a summary table of clusters. Each cluster’s size and the top 5 words are represented.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a summary table of the top 5 words defining each cluster</span>
cluster_summary &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">cluster =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(clustering),
                              <span class="dt">size =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(clustering)),
                              <span class="dt">top_words =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(cluster_words, <span class="cf">function</span>(d){
                                <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(
                                  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(d)[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(d, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) ][ <span class="dv">1</span><span class="op">:</span><span class="dv">5</span> ], 
                                  <span class="dt">collapse =</span> <span class="st">", "</span>)
                              }),
                              <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cluster_summary</code></pre></div>
<table class="table">
<caption>Cluster summary table</caption>
<thead><tr class="header">
<th align="right">cluster</th>
<th align="right">size</th>
<th align="left">top_words</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">23</td>
<td align="left">risk, health, diabetes, intervention, treatment</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">4</td>
<td align="left">hiv, inflammation, env, testing, study</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">38</td>
<td align="left">cell, infection, determine, cells, function</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">7</td>
<td align="left">research, program, cancer, disparities, students</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">8</td>
<td align="left">cancer, brain, imaging, tumor, metastatic</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">3</td>
<td align="left">microbiome, crc, gut, psoriasis, gut_microbiome</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">3</td>
<td align="left">cdk, nmdar, nmdars, calpain, tefb</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">7</td>
<td align="left">research, core, center, support, translational</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">3</td>
<td align="left">lung, ipf, expression, cells, methylation</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">4</td>
<td align="left">mitochondrial, metabolic, redox, ros, bde</td>
</tr>
</tbody>
</table>
<p>You may want a word cloud to visualize each cluster. Using the <code>wordcloud</code> package, we plot cluster 100 below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot a word cloud of one cluster as an example</span>
wordcloud<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/wordcloud/topics/wordcloud">wordcloud</a></span>(<span class="dt">words =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(cluster_words[[ <span class="dv">5</span> ]]), 
                     <span class="dt">freq =</span> cluster_words[[ <span class="dv">5</span> ]], 
                     <span class="dt">max.words =</span> <span class="dv">50</span>, 
                     <span class="dt">random.order =</span> <span class="ot">FALSE</span>, 
                     <span class="dt">colors =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"red"</span>, <span class="st">"yellow"</span>, <span class="st">"blue"</span>),
                     <span class="dt">main =</span> <span class="st">"Top words in cluster 100"</span>)</code></pre></div>
<p><img src="b_document_clustering_files/figure-html/unnamed-chunk-10-1.png" width="720"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#document-clustering">Document clustering</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tommy Jones.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '3c26218210734fb0fe605f17d745faba',
    indexName: 'rtextminer',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
